<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Upload</title>
</head>

<body>
    <h2>Upload Excel File</h2>
    <div id="dropContainer" style="border:1px solid black;height:100px;">
        Drop Here
    </div>
    <label for="email">Enter Email</label>
    <input type="text" placeholder="your@email.com" id="email">
    <label for="fileInput">Upload excel file</label>
    <input type="file" id="fileInput">
    <button onclick="uploadFile()">Upload</button>
    <p id="status"></p>

    <script>
        
        dropContainer.ondragover = dropContainer.ondragenter = function (evt) {
            evt.preventDefault();
        };

        dropContainer.ondrop = function (evt) {
            evt.preventDefault()
            fileInput.files = evt.dataTransfer.files;

            // If you want to use some of the dropped files
            const dT = new DataTransfer();
            dT.items.add(evt.dataTransfer.files[0]);
            dT.items.add(evt.dataTransfer.files[3]);
            fileInput.files = dT.files;

            evt.preventDefault();
        };
        function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (!file) {
                alert('Please select a file!');
                return;
            }

            const reader = new FileReader();

            reader.onload = function (event) {
                const fileData = event.target.result;

                const requestData = {
                    fileName: file.name,
                    email: document.querySelector("#email").value,
                    fileData: Array.from(new Uint8Array(fileData))
                };

                fetch('/upload', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                })
                    .then(res => res.text())
                    .then(response => {
                        document.getElementById('status').innerText = response;
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        document.getElementById('status').innerText = 'Error uploading file.';
                    });
            };

            reader.readAsArrayBuffer(file);
        }

    </script>
</body>

</html>